{% extends "base.html" %}
{% load humanize %}

{% block title %}{{ status|capfirst }} Status Details{% endblock %}

{% block breadcrumb %}
<ul class="breadcrumb">
  <li><a href="{% url 'mongo_status:index' %}">System Status</a> <span class="divider">/</span></li>
  <li class="active">{{ status|capfirst }} Status Details</li>
</ul>
{% endblock %}

{% block content %}
<div class="row">
  <div class="span12">
    <h1>{{ status|capfirst }} Records</h1>
  </div>
</div>
<div class="row">
  <div class="span12">
    <table class="table">
      <tr>
        <th>Status</th>
        <th># of records</th>
      </tr>
      <tr class="text-update">
        <td>Updates</td>
        <td>{{ status_details.updates|intcomma }}</td>
      </tr>
      <tr class="text-new">
        <td>New</td>
        <td>{{ status_details.new|intcomma }}</td>
      </tr>
      <tr class="text-delete">
        <td>Deletes</td>
        <td>{{ status_details.delete|intcomma }}</td>
      </tr>
      <tr class="text-special">
        <td>Special</td>
        <td>{{ status_details.special|intcomma }}</td>
      </tr>
      <tr class="text-legacy-migration">
        <td>Legacy Migration</td>
        <td>{{ status_details.legacy_migration|intcomma }}</td>
      </tr>
      <tr class="text-currently-migrating">
        <td>Currently Migrating</td>
        <td>{{ status_details.migrated|intcomma }}</td>
      </tr>
      <tr class="text-hand-selected">
        <td>Hand Selected</td>
        <td>{{ status_details.hand_selected|intcomma }}</td>
      </tr>
      <tr>
        <td><strong>Total</strong></td>
        <td><strong>{{ status_details.total|intcomma }}</strong></td>
      </tr>
    </table>
  </div>
</div>

{% if status_details.newest.date %}
  <p><strong>Newest</strong> {{ status }} asset, {{ status_details.newest.assetId }} at {{ status_details.newest.date }}</p>
{% endif %}
{% if status_details.oldest.date %}
  <p><strong>Oldest</strong> {{ status }} asset, {{ status_details.oldest.assetId }} at {{ status_details.oldest.date }}</p>
{% endif %}

<div class="row">
  <div class="span12">
    <p class="text-right"><small>Generated at {{ status_details.generation_time }}</small></p>
  </div>
</div>

<div class="row">
  <div class="span12">
    <div id="statusDetailsGraph"></div>
  </div>
</div>

<div class="row">
  <div class="span2 palette-turquoise card">
    <p>UPDATES</p>
    <p>Send changes to an existing asset</p>
  </div>
  <div class="span2 palette-emerland card">
    <p>NEW</p>
    <p>Provide a new asset to Getty</p>
  </div>
  <div class="span2 palette-alizarin card">
    <p>DELETES</p>
    <p>Disable an asset</p>
  </div>
  <div class="span2 palette-amethyst card">
    <p>SPECIAL</p>
    <p>Various operations. Usually 1 off jobs</p>
  </div>
  <div class="span2 palette-carrot card">
    <p>LEGACY MIGRATION</p>
    <p>Files already transferred to Getty outside of Bluesky</p>
  </div>
  <div class="span2 palette-sun-flower card">
    <p>CURRENTLY MIGRATING</p>
    <p>Files on the way to Getty systems outside of Bluesky</p>
  </div>
  <div class="span2 palette-peter-river card">
    <p>HAND SELECTED</p>
    <p>Files selected for Bluesky by an iStock employee</p>
  </div>
</div>

<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<script type="text/javascript">

  // Load the Visualization API and the piechart package.
  google.load('visualization', '1.0', {'packages':['corechart']});
  // Set a callback to run when the Google Visualization API is loaded.
  google.setOnLoadCallback(drawStatusDetailsChart);

  function drawStatusDetailsChart()
  {
    var data = new google.visualization.DataTable();
    data.addColumn('datetime', 'Date');
    data.addColumn('number', 'Updates');
    data.addColumn('number', 'New');
    data.addColumn('number', 'Deletes');
    data.addColumn('number', 'Special');
    data.addColumn('number', 'Legacy Migration');
    data.addColumn('number', 'Currently Migrating');
    data.addColumn('number', 'Hand Selected');

    data.addRows([
      {% for data_point in historical_data %}
        [new Date('{{ data_point.generation_time|date:"r" }}'), {{ data_point.updates }}, {{ data_point.new }}, {{ data_point.delete }}, {{ data_point.special }}, {{ data_point.legacy_migration }}, {{ data_point.migrated }}, {{ data_point.hand_selected }}],
      {% endfor %}
    ]);
    var options = {
      title: 'Historical Data',
      width: 940,
      height: 400,
      'colors':['#1ABC9C', '#2ECC71', '#E74C3C', '#9B59B6', '#E67E22', '#F1C40F', '#3498DB']
    };
    var chart = new google.visualization.LineChart(document.getElementById('statusDetailsGraph'));
    chart.draw(data, options);
 }
</script>
{% endblock %}
